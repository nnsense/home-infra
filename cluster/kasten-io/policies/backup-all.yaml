apiVersion: config.kio.kasten.io/v1alpha1
kind: Policy
metadata:
  name: backup-all
  namespace: kasten-io
spec:
  actions:
  - action: backup
    backupParameters:
      filters:
        excludeResources:
        - name: torrents-v2
          resource: persistentvolumeclaims
        includeResources:
        - resource: persistentvolumeclaims
      profile:
        name: backblaze-b2
        namespace: kasten-io
  - action: export
    exportParameters:
      exportData:
        enabled: true
        exporterStorageClassName: ssd-raid5-reclaim-v2
      frequency: '@daily'
      migrationToken:
        name: backup-all-migration-token
        namespace: kasten-io
      profile:
        name: backblaze-b2
        namespace: kasten-io
      # This is needed if all goes wrong and we need to restore
      receiveString: bIzAPpoanmFN3ypvkS1K1eVdcU02ABmUlDOWxUUeOpYfOL0dnTiWTLymW/TZut5oOzm/zKuNGU+u7zELhTr9mRMY6Q9FHu2VUNWWr9Sel5ONrvgyuXJKZEKE+6DoH6lyadEUmX5r3f5bu7OQ7NyN1FO1M+vukWFg31PiEgKeg/iU9I0wU06znD7XuTv5HzBYxoMmbKfxvVQT00o3MTiL9929XXSzHSjrpihH94zbaJdioYyeZS3AdosHtK2Qh965Mo7HabrPKMRhBWz4oUwm8nKIr/WQa+LO0QWYBGUlBWZ8WzKL+Wsz+XH56p3JpJkgwEE1apYKjnQAk8k+qSqRCuV676REKUdB2cRmxNG5v7P/w0SEgomH/Xt+llGriXw/4MT1Ocgemf38Q3F/lN38dROwkOhFR+KGoVGrmsVNOSxBkvZGLt/DdyZ0H0ff0Or3KkbfqeYvb/HdHV1HqEc0bzC5iJBj66pmPGXxO29HvIRG4VAvgBKBFA58OWFFCsrw1baQdwTYhC5y7ogezk2/kSFBv+0vXvCASSNpe9PlgWku+caUykJtRjjqpYyPptu/v0fa
    retention: {}
  frequency: '@hourly'
  modifiedBy: k10-admin
  retention:
    daily: 3
    hourly: 8
    monthly: 1
    weekly: 2
  selector:
    matchExpressions:
    - key: k10.kasten.io/appNamespace
      operator: In
      values:
      - automation
      - authelia
      - mailserver
      - vaultwarden
      - default
      - gitlab
      - media
