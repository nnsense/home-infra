---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: shelly-brightness
spec:
  schedule: '0 */1 * * *'
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  successfulJobsHistoryLimit: 3
  jobTemplate:
    metadata:
    spec:
      template:
        metadata:
        spec:
          containers:
          - args: [perl, /script/shelly-brightness.pl]
            image: ghcr.io/vaskozl/perl-libwww:6.72-1@sha256:74441c4a28f033fff4f35d3b29b6b90bce4b77a716248164b8f229a5ba056477
            name: shelly-brightness
            resources:
              requests:
                cpu: 50m
                memory: 128Mi
              limits:
                cpu: 100m
                memory: 256Mi
            volumeMounts:
            - mountPath: /script
              name: script
          restartPolicy: Never
          volumes:
          - configMap:
              defaultMode: 420
              name: script
            name: script
